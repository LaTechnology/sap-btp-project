#REST Client variables -------------------

#From the sm_url, last field in the service binding
@uri = https://service-manager.cfapps.us10.hana.ondemand.com

@oauth = oauth/token?grant_type=client_credentials

#From the url field in the service binding.
@uaa_url = https://7334a4f6trial.authentication.us10.hana.ondemand.com

#From the clientid field in the service binding.
@clientid =sb-bf2709d8-c0ed-4556-b048-fd0ec19d56ca!b224605|service-manager!b1476

#From the clientsecret field in the service binding.  
@clientsecret = 8f458bf0-59eb-4cb4-a13b-2fdbce0b9af0$daq9l9sYfz473mpzbbBdPaVYGofKDufnjaxh6dLFtT4=

#Generated by the request bearer token call.  Copy the access_token value from the result without the quotes
@bearer = eyJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vNzMzNGE0ZjZ0cmlhbC5hdXRoZW50aWNhdGlvbi51czEwLmhhbmEub25kZW1hbmQuY29tL3Rva2VuX2tleXMiLCJraWQiOiJkZWZhdWx0LWp3dC1rZXktLTExMjY3Mzk0MTkiLCJ0eXAiOiJKV1QiLCJqaWQiOiAiQmpuOTNZaDF2U0dpQzlWWC9IU2I0ZHFoNEMzZWFnK0tmdDJuZmwvMHRRMD0ifQ.eyJqdGkiOiI4NzkyY2Q4OTMyOWY0M2I3OGZhYmJiZmMyN2RiZjI5MyIsImV4dF9hdHRyIjp7ImVuaGFuY2VyIjoiWFNVQUEiLCJzdWJhY2NvdW50aWQiOiJjOTgwNmRjZC0xMGQ5LTQ5ZTUtYTkzZi05YjQ5YjE0ZThlYjkiLCJ6ZG4iOiI3MzM0YTRmNnRyaWFsIiwic2VydmljZWluc3RhbmNlaWQiOiJiZjI3MDlkOC1jMGVkLTQ1NTYtYjA0OC1mZDBlYzE5ZDU2Y2EifSwic3ViIjoic2ItYmYyNzA5ZDgtYzBlZC00NTU2LWIwNDgtZmQwZWMxOWQ1NmNhIWIyMjQ2MDV8c2VydmljZS1tYW5hZ2VyIWIxNDc2IiwiYXV0aG9yaXRpZXMiOlsic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9vZmZlcmluZy5yZWFkIiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9pbnN0YW5jZS5yZWFkIiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9wbGFuLnJlYWQiLCJ1YWEucmVzb3VyY2UiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5icm9rZXIucmVhZCIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnBsYXRmb3JtLnJlYWQiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX2JpbmRpbmcucmVhZCIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnBsYXRmb3JtLm1hbmFnZSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnNlcnZpY2VfYmluZGluZy5tYW5hZ2UiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX2luc3RhbmNlLm1hbmFnZSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LmJyb2tlci5tYW5hZ2UiXSwic2NvcGUiOlsic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9vZmZlcmluZy5yZWFkIiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9pbnN0YW5jZS5yZWFkIiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9wbGFuLnJlYWQiLCJ1YWEucmVzb3VyY2UiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5icm9rZXIucmVhZCIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnBsYXRmb3JtLnJlYWQiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX2JpbmRpbmcucmVhZCIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnBsYXRmb3JtLm1hbmFnZSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnNlcnZpY2VfYmluZGluZy5tYW5hZ2UiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX2luc3RhbmNlLm1hbmFnZSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LmJyb2tlci5tYW5hZ2UiXSwiY2xpZW50X2lkIjoic2ItYmYyNzA5ZDgtYzBlZC00NTU2LWIwNDgtZmQwZWMxOWQ1NmNhIWIyMjQ2MDV8c2VydmljZS1tYW5hZ2VyIWIxNDc2IiwiY2lkIjoic2ItYmYyNzA5ZDgtYzBlZC00NTU2LWIwNDgtZmQwZWMxOWQ1NmNhIWIyMjQ2MDV8c2VydmljZS1tYW5hZ2VyIWIxNDc2IiwiYXpwIjoic2ItYmYyNzA5ZDgtYzBlZC00NTU2LWIwNDgtZmQwZWMxOWQ1NmNhIWIyMjQ2MDV8c2VydmljZS1tYW5hZ2VyIWIxNDc2IiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsInJldl9zaWciOiJjOWZiZWFmMyIsImlhdCI6MTcwMzU5Mzk3OSwiZXhwIjoxNzAzNTk1Nzc5LCJpc3MiOiJodHRwczovLzczMzRhNGY2dHJpYWwuYXV0aGVudGljYXRpb24udXMxMC5oYW5hLm9uZGVtYW5kLmNvbS9vYXV0aC90b2tlbiIsInppZCI6ImM5ODA2ZGNkLTEwZDktNDllNS1hOTNmLTliNDliMTRlOGViOSIsImF1ZCI6WyJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX3BsYW4iLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5icm9rZXIiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5wbGF0Zm9ybSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnNlcnZpY2VfaW5zdGFuY2UiLCJ1YWEiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX29mZmVyaW5nIiwic2ItYmYyNzA5ZDgtYzBlZC00NTU2LWIwNDgtZmQwZWMxOWQ1NmNhIWIyMjQ2MDV8c2VydmljZS1tYW5hZ2VyIWIxNDc2Iiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9iaW5kaW5nIl19.iNc6aVdMM1rqw6XP4z2buZtQ67ZFJH_ruioiQlMObYJjOsnSqngkcIuKcASDpnjBDRC6WP-PRSTIxmxq-RoSz5apds1unuHITQRkkDzOV9GoJtTBzzSdfgu0t55nBkE9xNna5Fi-XKIL3kOQNue5skIKKBIaJ3BzhkmhC5AzZyi8AgDOY0eJLuO0KNNvEx4JoAAbODV0qyyG52K1pX7frfjo4ZB3wiRC08d2OVYwD-UadBJjRK7NfpcX0cuKIi3X-Y4VrWCqMqcMdznio_vNNMby2zHW8fG0fZT7aVrvr3fNNN9y09nl2Foes6iyklN4WYshSETZhZ_uWDF5aSRllg

#Instance ID of a SAP HANA Cloud instance in the same subaccount as the service manager instance
@instanceid = bf2709d8-c0ed-4556-b048-fd0ec19d56ca

#Authorization REST API call --------------------

#Request bearer token
#See also https://help.sap.com/docs/service-manager/sap-service-manager/retrieve-oauth2-access-token
#Note that by default the token expires after 1799 seconds or 30 minutes as seen in the response in the expires_in field
GET {{uaa_url}}/{{oauth}}
Authorization: Basic {{clientid}}:{{clientsecret}}

###

#Service plan query
#See also https://help.sap.com/docs/service-manager/sap-service-manager/filtering-parameters-and-operators
#See also https://api.sap.com/api/APIServiceManagment/resource/Service_Plans
GET {{uri}}/v1/service_plans?fieldQuery=name eq 'hana'
Authorization: Bearer {{bearer}}

###

#Instance query
#See also https://api.sap.com/api/APIServiceManagment/resource/Service_Instances
GET {{uri}}/v1/service_instances
Authorization: Bearer {{bearer}}

### 

#Instance query with filter
GET {{uri}}/v1/service_instances?fieldQuery=name eq 'HC_HDB'
Authorization: Bearer {{bearer}}

###

#Instance query with params
GET {{uri}}/v1/service_instances/{{instanceid}}/parameters
Authorization: Bearer {{bearer}}

###

#Update description of an instance provisioned in a subaccount (Other)
#Service manager can not update instances provisioned in Cloud Foundry spaces
PATCH {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}

{
    "parameters": {
        "metadata": {
          "ui.hc.sap.com/description": "Created as part of Automation Tutorial!"
        }
    }
}

###

#Update label
PATCH {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}

{
  "labels": [
    {
      "op": "add",
      "key": "Contact",
      "values": [
        "Dan at 123 456 7890"
      ]
    }
  ]
}

###

#Stop instance
PATCH {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}

{
    "parameters": {
        "data": {
            "serviceStopped": true
        }
    }
}

###

#Start instance
PATCH {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}

{
    "parameters": {
        "data": {
            "serviceStopped": false
        }
    }
}

###

#Create
#The service_plan_id and the systempassword will need to be updated
POST {{uri}}/v1/service_instances
Authorization: Bearer {{bearer}}
Content-Type: application/json
#Content-Type: application/x-www-form-urlencoded

{
  "name": "HC_HDB",
  "service_plan_id": "3647b218-dbf1-4cec-af64-cede4d48edbf",
  "parameters": {
    "data": {
      "systempassword": "ManagerPWD1234",
      "edition": "cloud",
      "memory": 30,
      "vcpu": 2,
      "additionalWorkers": 0,
      "whitelistIPs": [
        "0.0.0.0/0"
      ],
      "extensionservices": [
        {
          "name": "ConnectivityProxy",
          "enabled": false,
          "whitelistIPs": [
            "0.0.0.0/0"
          ]
        }
      ],
      "enabledservices": {
        "scriptserver": false,
        "docstore": false,
        "dpserver": true
      },
      "storage": 120,
      "availabilityZonePlacement": {
        "primaryAvailabilityZone": "us-east-1d",
        "highAvailabilityCrossMultiAZEnabled": false
      },
      "productVersion": {
        "releaseCycle": "generally-available-quarterly",
        "track": "2023.16"
      }
    },
    "metadata": {
      "ui.hc.sap.com/description": ""
    }
  }
}

###

#DELETE instance
DELETE {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}

@gateway_url = https://api.gateway.orchestration

#From host, part after instanceID.hana
@host = 2a24da70-607e-4295-b434-1499f32b66e8.hana.trial-us10.hanacloud.ondemand.com

#Alerts REST API calls --------------------------

#Get the triggered alerts (events) for a specific instance
GET {{gateway_url}}.{{host}}/alerts/v1/serviceInstances/{{serviceInstance}}/events?alertState=All&severity=INFO,NOTICE,WARNING,ERROR
Authorization: Bearer {{bearer}}

###

#Get the triggered alerts (events) for a specific instance for a specific time period such as 4 days ago
#The data is kept only for a certain duration, such as 7 days
#Note that only alerts that have an endTimestamp are returned
GET {{gateway_url}}.{{host}}/alerts/v1/serviceInstances/{{serviceInstance}}/events?alertState=All&severity=INFO,NOTICE,WARNING,ERROR&startTimestamp={{startTSAlerts}}&endTimestamp={{endTSAlerts}}
Authorization: Bearer {{bearer}}

###

#Get the triggered alerts (events) that are still active
GET {{gateway_url}}.{{host}}/alerts/v1/serviceInstances/{{serviceInstance}}/events?alertState=Active&startTimestamp={{startTSAlerts}}
Authorization: Bearer {{bearer}}


###

